# Contents of _/home/grg/spm_

* **MD** (mean diffusivity maps)
* **FA** (fractional anisotropy maps)
* **L1** (axial diffusivity maps): these tend to describe axonal loss spatial repartition
* **RD** (radial diffusivity maps): these tend to describe demyelination
* **Jacobians**: Jacobian maps derived from DARTEL flow fields (Raffaele's work)
* **unsomooted_jacobians**: unsmoothed version of Jacobian maps derived from
  DARTEL flow fields (Raffaele's work)
* **MD_corr** (corrected mean diffusivity maps): using Jacobian maps derived
  from DARTEL flow fields (Raffaele's work), we fit a linear model across subjects
  between all MD values and all Jacobian values for every voxel. The corrected
  value assigned to each voxel is the mean MD value across subjects minus the
  error (the difference between the predicted value and the observed value)

* **MD_pred** (predicted mean diffusivity maps): using Jacobian maps derived
  from DARTEL flow fields (Raffaele's work), we fit a linear model across subjects
  between all MD values and all Jacobian values for every voxel. We then assign
  each voxel with a predicted value given by the resulting model.

  This correction step using linear regression is done using
  `linreg_image_correction.py`.

* **c1**: smoothed modulated grey matter segmentations generated by Raffaele using SPM and
  taken as inputs for VBM.

* **scripts**: IPython Notebooks on current analyses
* **analyses**: outputs of all current analyses performed using various methods
  and design models.

* **designmat**: contains all the various design matrices SPM was run on.
* **dartel**: contains the relevant data (inputs/outputs) used for spatial
  normalization using DARTEL, including:
    - **T1**: the _original_ bias-corrected denoised T1 maps (_10010_mabonlm_nobias.nii_)
    - **spm12**: W/M segmentation maps using SPM12 (_10010_mabonlm_nobias_spm_c?.nii_)
      and mean images
    - **realigned_spm12**: realigned W/M segmentation maps using SPM/Realign (_r10010_mabonlm_nobias_spm_c?.nii_)
    - **templates**: resulting templates from DARTEL (_Template?.nii_)
    - **flowfields**: the flowfields corresponding to every subject with respect
      to the resulting template.
* **data**: miscellaneous data, covariates, JSON files, Excel tables (demographics,
    TIV, ventricular volumes, etc...)
* **ROIvent**: periventricular ROIs obtained in both T1 and DWI spaces
    after dilating ventricular segmentations
* **ROIapoE**: ROIs defined manually from significant clusters found in prior SPM
    analyses - contains two subfolders corresponding to two different normalization
    approaches used (ANTs or DARTEL): each contains folders with ROI values
    extracted from MD maps over the whole cohort (using resp. original MD maps,
    MD maps with CSF voxels removed (`p(csf)!=0` and `p(csf)>0.5`)

###Addendum:

**/home/grg/dartel_csf0**:

**/home/grg/dartel_csf.5**:

# How to use DARTEL scripts (`alfa/spm`)

One script `DARTEL.py` is used to generate a DARTEL template from previously
realigned sets of grey maps (`r*_c1.nii`) (NB: running the process in CLI or from
Matlab directly may save the overhead time due to Python/Nipype).
The script takes the path of the directory containing the realigned images and
a JSON file with a list of identifiers (allowing to select/discard subjects)

Then the registration of any modality to the generated template is done in four
steps:

- Co-registration `CoregDWI.py` of the given modality with respect to the T1/c1
(grey) maps.

- Spatial normalization `DARTELNorm2MNI.py` using the corresponding flowfields
and the generated template.

- Removal of the headers `remove_headers.py` from the resulting outputs
`(s)wr_*.nii`. This step is a walkaround to work out potential later confusions
with SPM handling referentials/transformations.

- Final co-registration with the MNI template `CoregMNI.py` (the spatial
  normalization is supposed to include this but the headers get removed). The
  goal is to obtain images that superimpose natively one onto the other without
  relying on their headers.
